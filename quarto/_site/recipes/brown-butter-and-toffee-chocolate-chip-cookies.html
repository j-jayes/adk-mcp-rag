<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kate Davis">
<meta name="dcterms.date" content="2025-10-07">

<title>Brown Butter and Toffee Chocolate Chip Cookies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-1d4f84655f446305ac42a8f1abcf7405.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="fullcontent quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Brown Butter and Toffee Chocolate Chip Cookies</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kate Davis </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 7, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="blurb" class="level2">
<h2 class="anchored" data-anchor-id="blurb">Blurb</h2>
<p>Using chocolate wafers instead of chips is a cookie game-changer. They spread as they melt, creating thin pockets of chocolate in each layer, and stay much softer at room temperature.</p>
</section>
<section id="ingredients" class="level2">
<h2 class="anchored" data-anchor-id="ingredients">Ingredients</h2>
<ul>
<li>1 cup (2 sticks; 227 g) unsalted butter</li>
<li>2 cups (250 g) all-purpose flour</li>
<li>1 teaspoon baking soda</li>
<li>¾ teaspoon kosher salt</li>
<li>1 cup (packed; 215 g) dark brown sugar</li>
<li>⅓ cup (73 g) granulated sugar</li>
<li>2 large eggs, room temperature</li>
<li>2 teaspoons vanilla extract</li>
<li>2 1.4-oz. (80 g total) chocolate toffee bars (preferably Skor), chopped into ¼-inch pieces</li>
<li>1½ cups (216 g) chocolate wafers (disks, pistoles, fèves; preferably 72% cacao)</li>
<li>Flaky sea salt</li>
</ul>
</section>
<section id="instructions" class="level2">
<h2 class="anchored" data-anchor-id="instructions">Instructions</h2>
<ol type="1">
<li>Cook butter in a medium saucepan over medium heat, stirring often, until it foams, then browns, 5–8 minutes. Scrape into a large bowl and let cool slightly., about 10 minutes (an instant-read thermometer should register 125°).</li>
<li>Meanwhile, whisk flour, baking soda, and kosher salt in a medium bowl.</li>
<li>Add brown sugar and granulated sugar to browned butter. Using an electric mixer on medium speed, beat until incorporated, about 1 minute. Add eggs and vanilla, increase mixer speed to medium-high, and beat until mixture lightens and begins to thicken, about 1 minute. Reduce mixer speed to low; add dry ingredients and beat just to combine. Mix in toffee pieces and chocolate wafers with a wooden spoon or rubber spatula. Let dough sit at room temperature at least 30 minutes to allow flour to hydrate. Dough will look very loose at first, but will thicken as it sits.</li>
<li>Place a rack in middle of oven; preheat to 375°. Using a 1-oz. ice cream scoop, portion out balls of dough and place on a parchment-lined baking sheet, spacing about 3” apart (you can also form dough into ping pong–sized balls with your hands). Do not flatten; cookies will spread as they bake. Sprinkle with sea salt.</li>
<li>Bake cookies until edges are golden brown and firm but centers are still soft, 9–11 minutes. Let cool on baking sheets 10 minutes, then transfer to a wire rack and let cool completely. Repeat with remaining dough and a fresh parchment-lined cooled baking sheet.</li>
<li>Do Ahead: Cookie dough can be made 3 days ahead; cover and chill. Let dough come to room temperature before baking.</li>
</ol>
</section>
<section id="end-blurb" class="level2">
<h2 class="anchored" data-anchor-id="end-blurb">End-blurb</h2>
</section>
<section id="comments" class="level2">
<h2 class="anchored" data-anchor-id="comments">Comments</h2>
<ul>
<li>I just love the taste and texture of these cookies. (We skip the toffee and only use chocolate chips)Our cookies never flatten out like they are supposed to, what would be the reason for that?</li>
<li>These cookies have been my go-to comfort food during the pandemic. They’re phenomenal; the brown butter makes a huge difference and using good quality chocolate wafers is so worth it. I always freeze most of the dough into portioned balls; that way, you can just bake a few at a time, and have awesome cookies whenever the need strikes.</li>
<li>These rule. In my long and illustrious career I haven’t done much baking but these RULE</li>
<li>Flat flat flat flatter than pancakes!?!? HELP! I followed all the instructions, every piece on ingredient….what could have made my cookies turn out like a pancake that flattened out the the size of my hand?!? An troubleshooting advice out there?</li>
<li>I’ve tried so many recipes in my life, and this one has to be my all time favorite. I dont need to make any substitutions. It’s just perfect. I make these ahead of time and freeze them for when i don’t have time or energy to make a dessert. I’ll make a few dozen and no cookie is ever left unclaimed when I set them out for loved ones. When I defrost them, I leave them on the kitchen counter uncovered for 30 minutes. They bake beautifully with the crispy edges and chewy center!</li>
<li>I loved it! This was the best recipe ever but could you also include how to make the toffee because I didn’t have any at hand and had to omit it but was still AWESOME! Also, this is much better and less time consuming than the Tasty one.</li>
<li>Love the detailed description, made it that much easier to get it right, my family loved it ! These cookies were so yum that they paired very well with vanilla ice cream too !!</li>
<li>These are the best cookies I’ve ever made. Every single person who’s tried them loves them. I’ve also used the same base and added different mix-ins and it’s always delicious. I’ve stopped making any other chocolate chip cookies because these are simply show stoppers</li>
<li>I no longer have use for regular chocolate chip cookies in my life. These are OUTSTANDING! A huge payoff for a relatively easy recipe. Subbed 70% choc chips &amp; Heath bits o’ brickle (bagged heath pieces without choc) because it’s what I had on hand. The browned butter took at least 20+ minutes to cool to 125 so just be mindful. If you have flaky sea salt on hand DO NOT skip that step, really pushes it over the edge. Will be making this on repeat for friends. Thanks BA!</li>
<li>I cannot believe how perfect these turned out using Gluten Free AP (Pamela’s). “I would have had no idea this wasn’t a normal cookie. I’d run a mile for one of these.” are the words that my husband just spoke after I had him try one of these when I subbed in GF All Purpose Flour! And he pretty decidedly stays away from my gluten-free things. This is going to be our new go-to cookie recipe as it has both sides of the gluten-free divide VERY happy. I weighed my cookies out by 1oz and got 41 cookies (although I also went a little heavier on both chips than the recipe called for). Never browned butter for cookies before and it is SO worth it.</li>
<li>I’ve made this recipe probably 5 or 6 times now; it’s become my go-to chocolate chip cookie recipe. Some tips I’ve found thru trial and error: -try not to stir the butter while it’s browning -the butter foams up when it’s getting close to done, which makes it hard to see what color it is.. I find it’s best to just do it by smell -brown butter forms little bits at the bottom.. that’s fine, they’re little caramels! -don’t skip or skimp on the creaming butter and sugar phase! Some notes: -I find a noticeable difference in the outcome when I let the batter sit for 30 minutes as recommended vs when I don’t.. letting it sit and hydrate results in a fluffier and lighter cookie, whereas baking it immediately results in a thinner more chewy cookie -the dough can of course be refrigerated, but it seems to lose some of the lovely brown butter flavor when it’s been saved -I almost always add pecans or walnuts, and that’s obviously delicious and works well -sometimes I add cinnamon or even cayenne, which is great</li>
<li>These cookies are insanely good - I have made this recipe about once a month for the last six months and each time they have turned out delicious! I highly recommend this recipe, it will be my go to for a sweet treat for years to come :-)</li>
<li>These cookies are insanely good - I have made this recipe about once a month for the last six months and each time they have turned out delicious! I highly recommend this recipe, it will be my go to for a sweet treat for years to come :-)</li>
<li>These are the best chocolate chip cookies I’ve ever made and/or eaten. I’ve made them so many times since I stumbled onto this recipe. My friends, neighbors and family thank you.</li>
<li>These cookies are DELICIOUS. Absolutely delicious. Big hit with everyone in my house, and I sent the recipe to my parents and they’re now my father’s favorite, too. I would even increase the ratio of toffee bits to chocolate; that’s literally the only thing I’d do differently, but it’s because I just really love toffee.</li>
<li>I have made these cookies several times. They are my favorite, and numerous people I’ve baked them for have told me, “this is the best chocolate chip cookie I’ve ever had”- including my grandma, whose cookies were my favorite growing up! I use heath bits, and a few more grams of high quality dark chocolate than the recipe calls for. The first couple times, they came out a bit cakey (while still having excellent flavor). The third time, and every time since, I’ve done two things differently: measured by weight instead of cups, and pulled the baking sheet out mid-bake to give it a solid whack and knock down the cookies. I’m not sure which technique (or both) did the trick, but they now turn out PERFECTLY every time! Wide flat cookies, crispy at the edges and chewy at the centers; with the slight salty tang of the flaky sea salt melding perfectly with the caramelized notes from the browned butter and toffee. Mmmmmmm. Can’t wait to make them again!</li>
<li>Listen, I’m not playing around: these are the best cookies I have ever made in my life. There is no better cookie. The end.</li>
<li>Yes, these are the bomb. Dangerously so. I used 63% discs from KAF. Skor bits. I got 26 1.5 ounce cookies. One sheet at a time on middle rack. 6 per sheet. Baked 4 mins, rotated 3 mins, then dropped cookie sheet on stove top to deflate, cooked 2-3 mins more. Worked great. They must leave my house immediately.</li>
<li>This is my go to cookie recipe, the toffee really goes so well with the brown butter. I used dark chocolate wafers from ghirardelli, I do not like bittersweet chocolate. Now with PUFFY cookies…I’ve made this recipe several times already and never knew why they were puffy until recently. People have suggested to use baking soda instead of powder (recipe calls for soda so use soda). Eggs must be at room temp…didn’t make a difference to me. Batter should not be over mixed…I’ve mixed this with a hand held mixer for 10 mins to get that thick consistency and pale color, I also mixed it with a spatula and got it to a dark caramel color and loose consistency. All of this did not really have an effect. BUTTT when you’re scooping out the dough, do not roll into a ball and compact it together, just scoop and place on the tray. The denser you pack the dough, the more puffy they’ll get. Also, it depends on your oven. I place two trays in my oven, top and bottom rack. The top rack, the cookies came out nice and thin, crispy and chewy, they were perfect. Bottom rack, they did not spread out as much. The high heat really helps with the spread of the cookie as well. So just keep those two factors in mind. Either way, puffy or not they’re still delicious.</li>
<li>This was an exceptional recipe! I have made it about 10 times. The last few times I made it, the cookies puffed and didn’t spread. I just made another batch and they did spread like the original recipe. The difference between these batches was cooking by weight. When I cooked by weight, they turned out better. When I didn’t, and cooked the conventional way by cup etc, that is when they puffed up. Hopefully this helps! Keep on trying! They taste good either way.</li>
<li>Love these cookies! Didn’t have access to toffee bars but had sweetened condensed milk I wasn’t going to use at home so made some condensed milk toffee which beautifully complimented the cookie. I live in a warmer climate and when I baked the cookies straight from making the dough I got beautiful spread but the next day from baking the cooled dough from the refrigerator they were puffier and more cake like. So for those with the puffy cookie recipe make sure to bake your dough from room temp.</li>
<li>While this recipe might be “easier” that Chris’s recipe (which has more intricate steps to achieve that ‘perfect’ cookie), Rick’a cookie really seems to take the cake for the most flavorful cookie of them all. I am so impressed! The toffee Is Definetly incredible here but if you don’t like it I’m sure you could leave it out and use just a little more chocolate.</li>
<li>Made these a second time and I think I have a suggestion re: puffy cookies. If you watch the video Rick uses a stand up mixer to combine the flour. Don’t do this unless you have a stand up, my hand mixer is way too powerful, even on the lowest setting so combine the flour with a spatula Instead, in the poofy cookies the flour has been overworked. Tried these with just toffee chips (100g as someone suggested) and I’d say it almost worked better than with the skor bar bits.</li>
<li>These are incredible!! If you don’t have access to Skor bars, Rick posted a Skor bar recipe to his instagram a while ago, and they’re so so amazing! Sprinkle 1/2 chopped almonds in a parchment lined pan, and in a sauce pan boil 1 cup butter, 1 cup sugar, and 1/4 cup water to 312 F, 15 min until medium amber! Then remove from heat and add 2 teaspoons vanilla. Lastly pour it into pan over the almonds and let sit for 5 minutes, then sprinkle 1 cup chopped milk chocolate and let melt and spread. Let it cool completely, and cut into pieces! This makes enough for at least 4 batches.</li>
<li>THE MOST AMAZING TOFFEE-FILLED, CHOCOLATELY, BROWN BUTTERY GOODNESS! Will definitely make again and again. You can also chop your own dark chocolate into chunks instead of using buttons, but the Skor bits is a must have!</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>